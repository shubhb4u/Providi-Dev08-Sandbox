window,window._walkmeWebpackJP&&(window._walkmeWebpackJP=window._walkmeWebpackJP||[]).push([[5],{382:function(t,e,s){"use strict";s.r(e),s.d(e,"AttentionGrabberDataManager",function(){return i});var e=s(133),a=s(24),i=(n.prototype.updateSelection=function(t){this.selectedId=t,this.save()},n.prototype.updateEvent=function(){this._eventTimestamp=(new Date).getTime(),this.save()},n.prototype.updateUnload=function(){this.unload=1,this.save()},n.prototype.init=function(){var t,e,s=this._clientOrServerStorageManager.getData(this.AG_DATA_COOKIE_NAME),a=(new Date).getTime(),i=this._siteConfigManager.get().Settings,n=parseInt(i.AGDataVersion)||0;s?(this._sessionTimestamp=a,this.sessionCounter=s.sc||1,this._version=this._commonUtils.isDefined(s.v)?s.v:n,this._shouldUpdateVersion=n>this._version,t=s.st?Math.abs(a-s.st):0,e=void 0,this.localStorage&&(e=this.localStorage.getItem(this._clientOrServerStorageManager.keysConfig.attentionGrabber.sessionLength.key)),this._sessionLength=parseFloat(e||i.AGSL||1440),this._shouldUpdateCounter=t/6e4>this._sessionLength,this.isNewSession=this._shouldUpdateCounter||this._shouldUpdateVersion,this.sessionCounter=this._shouldUpdateVersion?1:this._shouldUpdateCounter?this.sessionCounter+1:this.sessionCounter,this._version=this._shouldUpdateVersion?n:s.v,this.selectedId=this.isNewSession?void 0:s.id,this._eventTimestamp=this.isNewSession?a:s.et,this.unload=this.isNewSession?0:s.u,this.eventTimestampDelta=this._eventTimestamp?Math.abs(a-this._eventTimestamp):0):(this.isNewSession=!0,this._sessionTimestamp=a,this.sessionCounter=1,this._version=n,this._eventTimestamp=a,this.unload=0),this._dataManagerWasInit=!0,this.save()},n.prototype.save=function(){var t;this._dataManagerWasInit&&(t={st:this._sessionTimestamp,sc:this.sessionCounter,v:this._version,id:this.selectedId,et:this._eventTimestamp,u:this.unload},this._clientOrServerStorageManager.saveData(this.AG_DATA_COOKIE_NAME,t,this._clientOrServerStorageManager.keysConfig.attentionGrabber.data.expiry))},n);function n(t,e,s){this.localStorage=Object(a.get)(),this._dataManagerWasInit=!1,this._siteConfigManager=t,this._clientOrServerStorageManager=e,this._commonUtils=s,this.AG_DATA_COOKIE_NAME=e.keysConfig.attentionGrabber.data.key}e.register("AttentionGrabberDataManager").asCtor(i).dependencies("SiteConfigManager, ClientOrServerStorageManager, CommonUtils")},383:function(t,e,a){"use strict";a.r(e),a.d(e,"AttentionGrabberManager",function(){return s});var i=a(0),n=a(133),s=(o.prototype.init=function(t){var e,s;t.config&&t.player&&(this._config=t.config,this._player=t.player,this._menu=t.menu,e=this._config.Settings.AG,(s=this._config.Settings.AGs)&&0<s.length?(this._agDataManager.init(),this.initAllAGs(s)):e&&this.create(t).setupAttenGrab())},o.prototype.reset=function(){this._agData=this._agClass=this._config=this._player=this._menu=void 0},o.prototype.blockLoad=function(){this._blockLoad=!0},o.prototype.initAllAGs=function(t){var e;this._agDataManager.isNewSession?(e=(e=this.getPotentialAGsForNewSession(t)).sort(function(t,e){return t.Priority-e.Priority}),this.updateAGForNewSession(e)):this.updateAGForOldSession(t),this._agData?(this._logger.customerLog("Attention grabber - name: "+this._agData.Name+", settings:",3),this._logger.customerLog(this._agData.Settings,3)):this._logger.customerLog("Attention grabber: not selected",3),t="Attention grabber data: session counter = "+this._agDataManager.sessionCounter+", selected AG = "+this._agDataManager.selectedId+", unload AG = "+this._agDataManager.unload+", event timestamp delta = "+this._agDataManager.eventTimestampDelta/1e3+"s, session = "+this._agDataManager.isNewSession,this._logger.customerLog(t,4)},o.prototype.getPotentialAGsForNewSession=function(t){for(var e=[],s=this._agDataManager.sessionCounter,a=0;a<t.length;a++){var i=t[a],n=i.Settings;this.shouldPlayAtSession(s,n)&&(parseInt(n.newContent)?this._publishDataManager.hasNewDeployables()&&(i.Priority-=this.NEW_CONTENT_PRIORITY,e.push(i)):e.push(i))}return e},o.prototype.updateAGForNewSession=function(t){for(var e=0;e<t.length;e++){var s=t[e],a=s.Settings;if(!a.conditions)return this._agData=s,void this._agDataManager.updateSelection(s.Id);if(this._conditionTreeEvaluator.evaluate(a.conditions))return this._agData=s,void this._agDataManager.updateSelection(s.Id)}},o.prototype.updateAGForOldSession=function(t){for(var e=this._agDataManager.sessionCounter,s=0;s<t.length;s++){var a=t[s];if(a.Settings,a.Id==this._agDataManager.selectedId){var i=a.Settings;return void(this.shouldPlayAtSession(e,i)&&this.shouldReplayAG(i)&&(!i.conditions||this._conditionTreeEvaluator.evaluate(i.conditions)?(this._agData=a,this._agDataManager.updateSelection(a.Id)):this._logger.customerLog("Attention grabber conditions are not satisfied",5)))}}},o.prototype.shouldPlayAtSession=function(t,e){return!(!(e&&this.commonUtils.isDefined(e.session)&&this.commonUtils.isDefined(e.interval))||t<e.session||t!=e.session&&(0==e.interval||(t-e.session)%e.interval!=0))},o.prototype.shouldReplayAG=function(t){if(this._agDataManager.unload)return!1;if(!t)return!1;var e=this._agDataManager.eventTimestampDelta,s=parseInt(t.replay);return!(!s||!e)&&(t.delay=(s=60*s*1e3)<e?0:(s-e)/1e3,!0)},o.prototype.load=function(s){return Object(i.__awaiter)(this,void 0,void 0,function(){var e;return Object(i.__generator)(this,function(t){switch(t.label){case 0:return!this._agData||this._blockLoad?[2]:(e={config:this._config,player:this._player,menu:this._menu,agData:this._agData},[4,a.e(4).then(a.bind(null,1179))]);case 1:return t.sent(),this._agClass=n.create("AttentionGrabber",e),this._agClass.setupAttenGrab(),s&&s(),[2]}})})},o.prototype.remove=function(t){this._agClass?(this._agDataManager.updateUnload(),this._agClass.remove(t)):t&&t()},o.prototype.create=function(t){return this._config=t.config,this._player=t.player,this._agClass=n.create("AttentionGrabber",t),this._agClass},o.prototype.getImageAG=function(t){return this._config=t.config,this._player=t.player,this._agClass=n.create("ImageAttentionGrabber",t),this._agClass},o);function o(t,e,s,a,i,n){this.commonUtils=n,this._blockLoad=!1,this.NEW_CONTENT_PRIORITY=1e3,this._conditionTreeEvaluator=t,this._clientOrServerStorageManager=s,this._publishDataManager=a,this._logger=i,this._agDataManager=e}n.register("AttentionGrabberManager").asCtor(s).dependencies("ConditionTreeEvaluator, AttentionGrabberDataManager, ClientOrServerStorageManager, PublishDataManager, Logger, CommonUtils, SiteConfigManager, Consts")}}]);